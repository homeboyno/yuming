"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e};!function(e){"function"==typeof define&&define.amd?define(["jquery"],e):e("object"===("undefined"==typeof exports?"undefined":_typeof(exports))?require("jquery"):jQuery)}(function(e){var t=0,i=Array.prototype.slice;e.cleanData=function(t){return function(i){var n,o,r;for(r=0;null!=(o=i[r]);r++)try{n=e._data(o,"events"),n&&n.remove&&e(o).triggerHandler("remove")}catch(s){}t(i)}}(e.cleanData),e.widget=function(t,i,n){var o,r,s,a,l={},u=t.split(".")[0];return t=t.split(".")[1],o=u+"-"+t,n||(n=i,i=e.Widget),e.expr[":"][o.toLowerCase()]=function(t){return!!e.data(t,o)},e[u]=e[u]||{},r=e[u][t],s=e[u][t]=function(e,t){return this._createWidget?void(arguments.length&&this._createWidget(e,t)):new s(e,t)},e.extend(s,r,{version:n.version,_proto:e.extend({},n),_childConstructors:[]}),a=new i,a.options=e.widget.extend({},a.options),e.each(n,function(t,n){return e.isFunction(n)?void(l[t]=function(){var e=function(){return i.prototype[t].apply(this,arguments)},o=function(e){return i.prototype[t].apply(this,e)};return function(){var t,i=this._super,r=this._superApply;return this._super=e,this._superApply=o,t=n.apply(this,arguments),this._super=i,this._superApply=r,t}}()):void(l[t]=n)}),s.prototype=e.widget.extend(a,{widgetEventPrefix:r?a.widgetEventPrefix||t:t},l,{constructor:s,namespace:u,widgetName:t,widgetFullName:o}),r?(e.each(r._childConstructors,function(t,i){var n=i.prototype;e.widget(n.namespace+"."+n.widgetName,s,i._proto)}),delete r._childConstructors):i._childConstructors.push(s),e.widget.bridge(t,s),s},e.widget.extend=function(t){for(var n,o,r=i.call(arguments,1),s=0,a=r.length;a>s;s++)for(n in r[s])o=r[s][n],r[s].hasOwnProperty(n)&&void 0!==o&&(e.isPlainObject(o)?t[n]=e.isPlainObject(t[n])?e.widget.extend({},t[n],o):e.widget.extend({},o):t[n]=o);return t},e.widget.bridge=function(t,n){var o=n.prototype.widgetFullName||t;e.fn[t]=function(r){var s="string"==typeof r,a=i.call(arguments,1),l=this;return s?this.each(function(){var i,n=e.data(this,o);return"instance"===r?(l=n,!1):n?e.isFunction(n[r])&&"_"!==r.charAt(0)?(i=n[r].apply(n,a),i!==n&&void 0!==i?(l=i&&i.jquery?l.pushStack(i.get()):i,!1):void 0):e.error("no such method '"+r+"' for "+t+" widget instance"):e.error("cannot call methods on "+t+" prior to initialization; attempted to call method '"+r+"'")}):(a.length&&(r=e.widget.extend.apply(null,[r].concat(a))),this.each(function(){var t=e.data(this,o);t?(t.option(r||{}),t._init&&t._init()):e.data(this,o,new n(r,this))})),l}},e.Widget=function(){},e.Widget._childConstructors=[],e.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",defaultElement:"<div>",options:{disabled:!1,create:null},_createWidget:function(i,n){n=e(n||this.defaultElement||this)[0],this.element=e(n),this.uuid=t++,this.eventNamespace="."+this.widgetName+this.uuid,this.bindings=e(),this.hoverable=e(),this.focusable=e(),n!==this&&(e.data(n,this.widgetFullName,this),this._on(!0,this.element,{remove:function(e){e.target===n&&this.destroy()}}),this.document=e(n.style?n.ownerDocument:n.document||n),this.window=e(this.document[0].defaultView||this.document[0].parentWindow)),this.options=e.widget.extend({},this.options,this._getCreateOptions(),i),this._create(),this._trigger("create",null,this._getCreateEventData()),this._init()},_getCreateOptions:e.noop,_getCreateEventData:e.noop,_create:e.noop,_init:e.noop,destroy:function(){this._destroy(),this.element.unbind(this.eventNamespace).removeData(this.widgetFullName).removeData(e.camelCase(this.widgetFullName)),this.widget().unbind(this.eventNamespace).removeAttr("aria-disabled").removeClass(this.widgetFullName+"-disabled ui-state-disabled"),this.bindings.unbind(this.eventNamespace),this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus")},_destroy:e.noop,widget:function(){return this.element},option:function(t,i){var n,o,r,s=t;if(0===arguments.length)return e.widget.extend({},this.options);if("string"==typeof t)if(s={},n=t.split("."),t=n.shift(),n.length){for(o=s[t]=e.widget.extend({},this.options[t]),r=0;r<n.length-1;r++)o[n[r]]=o[n[r]]||{},o=o[n[r]];if(t=n.pop(),1===arguments.length)return void 0===o[t]?null:o[t];o[t]=i}else{if(1===arguments.length)return void 0===this.options[t]?null:this.options[t];s[t]=i}return this._setOptions(s),this},_setOptions:function(e){var t;for(t in e)this._setOption(t,e[t]);return this},_setOption:function(e,t){return this.options[e]=t,"disabled"===e&&(this.widget().toggleClass(this.widgetFullName+"-disabled",!!t),t&&(this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus"))),this},enable:function(){return this._setOptions({disabled:!1})},disable:function(){return this._setOptions({disabled:!0})},_on:function(t,i,n){var o,r=this;"boolean"!=typeof t&&(n=i,i=t,t=!1),n?(i=o=e(i),this.bindings=this.bindings.add(i)):(n=i,i=this.element,o=this.widget()),e.each(n,function(n,s){function a(){return t||r.options.disabled!==!0&&!e(this).hasClass("ui-state-disabled")?("string"==typeof s?r[s]:s).apply(r,arguments):void 0}"string"!=typeof s&&(a.guid=s.guid=s.guid||a.guid||e.guid++);var l=n.match(/^([\w:-]*)\s*(.*)$/),u=l[1]+r.eventNamespace,p=l[2];p?o.delegate(p,u,a):i.bind(u,a)})},_off:function(t,i){i=(i||"").split(" ").join(this.eventNamespace+" ")+this.eventNamespace,t.unbind(i).undelegate(i),this.bindings=e(this.bindings.not(t).get()),this.focusable=e(this.focusable.not(t).get()),this.hoverable=e(this.hoverable.not(t).get())},_delay:function(e,t){function i(){return("string"==typeof e?n[e]:e).apply(n,arguments)}var n=this;return setTimeout(i,t||0)},_hoverable:function(t){this.hoverable=this.hoverable.add(t),this._on(t,{mouseenter:function(t){e(t.currentTarget).addClass("ui-state-hover")},mouseleave:function(t){e(t.currentTarget).removeClass("ui-state-hover")}})},_focusable:function(t){this.focusable=this.focusable.add(t),this._on(t,{focusin:function(t){e(t.currentTarget).addClass("ui-state-focus")},focusout:function(t){e(t.currentTarget).removeClass("ui-state-focus")}})},_trigger:function(t,i,n){var o,r,s=this.options[t];if(n=n||{},i=e.Event(i),i.type=(t===this.widgetEventPrefix?t:this.widgetEventPrefix+t).toLowerCase(),i.target=this.element[0],r=i.originalEvent)for(o in r)o in i||(i[o]=r[o]);return this.element.trigger(i,n),!(e.isFunction(s)&&s.apply(this.element[0],[i].concat(n))===!1||i.isDefaultPrevented())}},e.each({show:"fadeIn",hide:"fadeOut"},function(t,i){e.Widget.prototype["_"+t]=function(n,o,r){"string"==typeof o&&(o={effect:o});var s,a=o?o===!0||"number"==typeof o?i:o.effect||i:t;o=o||{},"number"==typeof o&&(o={duration:o}),s=!e.isEmptyObject(o),o.complete=r,o.delay&&n.delay(o.delay),s&&e.effects&&e.effects.effect[a]?n[t](o):a!==t&&n[a]?n[a](o.duration,o.easing,r):n.queue(function(i){e(this)[t](),r&&r.call(n[0]),i()})}});e.widget});var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e};!function(e){"function"==typeof define&&define.amd?define(["jquery"],e):e("object"===("undefined"==typeof exports?"undefined":_typeof(exports))?require("jquery"):window.jQuery)}(function(e){var t=0;e.ajaxTransport("iframe",function(i){if(i.async){var n,o,r,s=i.initialIframeSrc||"javascript:false;";return{send:function(a,l){n=e('<form style="display:none;"></form>'),n.attr("accept-charset",i.formAcceptCharset),r=/\?/.test(i.url)?"&":"?","DELETE"===i.type?(i.url=i.url+r+"_method=DELETE",i.type="POST"):"PUT"===i.type?(i.url=i.url+r+"_method=PUT",i.type="POST"):"PATCH"===i.type&&(i.url=i.url+r+"_method=PATCH",i.type="POST"),t+=1,o=e('<iframe src="'+s+'" name="iframe-transport-'+t+'"></iframe>').bind("load",function(){var t,r=e.isArray(i.paramName)?i.paramName:[i.paramName];o.unbind("load").bind("load",function(){var t;try{if(t=o.contents(),!t.length||!t[0].firstChild)throw new Error}catch(i){t=void 0}l(200,"success",{iframe:t}),e('<iframe src="'+s+'"></iframe>').appendTo(n),window.setTimeout(function(){n.remove()},0)}),n.prop("target",o.prop("name")).prop("action",i.url).prop("method",i.type),i.formData&&e.each(i.formData,function(t,i){e('<input type="hidden"/>').prop("name",i.name).val(i.value).appendTo(n)}),i.fileInput&&i.fileInput.length&&"POST"===i.type&&(t=i.fileInput.clone(),i.fileInput.after(function(e){return t[e]}),i.paramName&&i.fileInput.each(function(t){e(this).prop("name",r[t]||i.paramName)}),n.append(i.fileInput).prop("enctype","multipart/form-data").prop("encoding","multipart/form-data"),i.fileInput.removeAttr("form")),n.submit(),t&&t.length&&i.fileInput.each(function(i,n){var o=e(t[i]);e(n).prop("name",o.prop("name")).attr("form",o.attr("form")),o.replaceWith(n)})}),n.append(o).appendTo(document.body)},abort:function(){o&&o.unbind("load").prop("src",s),n&&n.remove()}}}}),e.ajaxSetup({converters:{"iframe text":function(t){return t&&e(t[0].body).text()},"iframe json":function(t){return t&&e.parseJSON(e(t[0].body).text())},"iframe html":function(t){return t&&e(t[0].body).html()},"iframe xml":function(t){var i=t&&t[0];return i&&e.isXMLDoc(i)?i:e.parseXML(i.XMLDocument&&i.XMLDocument.xml||e(i.body).html())},"iframe script":function(t){return t&&e.globalEval(e(t[0].body).text())}}})});var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e};!function(e){"function"==typeof define&&define.amd?define(["jquery","jquery.ui.widget"],e):"object"===("undefined"==typeof exports?"undefined":_typeof(exports))?e(require("jquery"),require("./vendor/jquery.ui.widget")):e(window.jQuery)}(function(e){function t(t){var i="dragover"===t;return function(n){n.dataTransfer=n.originalEvent&&n.originalEvent.dataTransfer;var o=n.dataTransfer;o&&-1!==e.inArray("Files",o.types)&&this._trigger(t,e.Event(t,{delegatedEvent:n}))!==!1&&(n.preventDefault(),i&&(o.dropEffect="copy"))}}e.support.fileInput=!(new RegExp("(Android (1\\.[0156]|2\\.[01]))|(Windows Phone (OS 7|8\\.0))|(XBLWP)|(ZuneWP)|(WPDesktop)|(w(eb)?OSBrowser)|(webOS)|(Kindle/(1\\.0|2\\.[05]|3\\.0))").test(window.navigator.userAgent)||e('<input type="file">').prop("disabled")),e.support.xhrFileUpload=!(!window.ProgressEvent||!window.FileReader),e.support.xhrFormDataFileUpload=!!window.FormData,e.support.blobSlice=window.Blob&&(Blob.prototype.slice||Blob.prototype.webkitSlice||Blob.prototype.mozSlice),e.widget("blueimp.fileupload",{options:{dropZone:e(document),pasteZone:void 0,fileInput:void 0,replaceFileInput:!0,paramName:void 0,singleFileUploads:!0,limitMultiFileUploads:void 0,limitMultiFileUploadSize:void 0,limitMultiFileUploadSizeOverhead:512,sequentialUploads:!1,limitConcurrentUploads:void 0,forceIframeTransport:!1,redirect:void 0,redirectParamName:void 0,postMessage:void 0,multipart:!0,maxChunkSize:void 0,uploadedBytes:void 0,recalculateProgress:!0,progressInterval:100,bitrateInterval:500,autoUpload:!0,messages:{uploadedBytes:"Uploaded bytes exceed file size"},i18n:function(t,i){return t=this.messages[t]||t.toString(),i&&e.each(i,function(e,i){t=t.replace("{"+e+"}",i)}),t},formData:function(e){return e.serializeArray()},add:function(t,i){return t.isDefaultPrevented()?!1:void((i.autoUpload||i.autoUpload!==!1&&e(this).fileupload("option","autoUpload"))&&i.process().done(function(){i.submit()}))},processData:!1,contentType:!1,cache:!1,timeout:0},_specialOptions:["fileInput","dropZone","pasteZone","multipart","forceIframeTransport"],_blobSlice:e.support.blobSlice&&function(){var e=this.slice||this.webkitSlice||this.mozSlice;return e.apply(this,arguments)},_BitrateTimer:function(){this.timestamp=Date.now?Date.now():(new Date).getTime(),this.loaded=0,this.bitrate=0,this.getBitrate=function(e,t,i){var n=e-this.timestamp;return(!this.bitrate||!i||n>i)&&(this.bitrate=(t-this.loaded)*(1e3/n)*8,this.loaded=t,this.timestamp=e),this.bitrate}},_isXHRUpload:function(t){return!t.forceIframeTransport&&(!t.multipart&&e.support.xhrFileUpload||e.support.xhrFormDataFileUpload)},_getFormData:function(t){var i;return"function"===e.type(t.formData)?t.formData(t.form):e.isArray(t.formData)?t.formData:"object"===e.type(t.formData)?(i=[],e.each(t.formData,function(e,t){i.push({name:e,value:t})}),i):[]},_getTotal:function(t){var i=0;return e.each(t,function(e,t){i+=t.size||1}),i},_initProgressObject:function(t){var i={loaded:0,total:0,bitrate:0};t._progress?e.extend(t._progress,i):t._progress=i},_initResponseObject:function(e){var t;if(e._response)for(t in e._response)e._response.hasOwnProperty(t)&&delete e._response[t];else e._response={}},_onProgress:function(t,i){if(t.lengthComputable){var n,o=Date.now?Date.now():(new Date).getTime();if(i._time&&i.progressInterval&&o-i._time<i.progressInterval&&t.loaded!==t.total)return;i._time=o,n=Math.floor(t.loaded/t.total*(i.chunkSize||i._progress.total))+(i.uploadedBytes||0),this._progress.loaded+=n-i._progress.loaded,this._progress.bitrate=this._bitrateTimer.getBitrate(o,this._progress.loaded,i.bitrateInterval),i._progress.loaded=i.loaded=n,i._progress.bitrate=i.bitrate=i._bitrateTimer.getBitrate(o,n,i.bitrateInterval),this._trigger("progress",e.Event("progress",{delegatedEvent:t}),i),this._trigger("progressall",e.Event("progressall",{delegatedEvent:t}),this._progress)}},_initProgressListener:function(t){var i=this,n=t.xhr?t.xhr():e.ajaxSettings.xhr();n.upload&&(e(n.upload).bind("progress",function(e){var n=e.originalEvent;e.lengthComputable=n.lengthComputable,e.loaded=n.loaded,e.total=n.total,i._onProgress(e,t)}),t.xhr=function(){return n})},_isInstanceOf:function(e,t){return Object.prototype.toString.call(t)==="[object "+e+"]"},_initXHRData:function(t){var i,n=this,o=t.files[0],r=t.multipart||!e.support.xhrFileUpload,s="array"===e.type(t.paramName)?t.paramName[0]:t.paramName;t.headers=e.extend({},t.headers),t.contentRange&&(t.headers["Content-Range"]=t.contentRange),r&&!t.blob&&this._isInstanceOf("File",o)||(t.headers["Content-Disposition"]='attachment; filename="'+encodeURI(o.name)+'"'),r?e.support.xhrFormDataFileUpload&&(t.postMessage?(i=this._getFormData(t),t.blob?i.push({name:s,value:t.blob}):e.each(t.files,function(n,o){i.push({name:"array"===e.type(t.paramName)&&t.paramName[n]||s,value:o})})):(n._isInstanceOf("FormData",t.formData)?i=t.formData:(i=new FormData,e.each(this._getFormData(t),function(e,t){i.append(t.name,t.value)})),t.blob?i.append(s,t.blob,o.name):e.each(t.files,function(o,r){(n._isInstanceOf("File",r)||n._isInstanceOf("Blob",r))&&i.append("array"===e.type(t.paramName)&&t.paramName[o]||s,r,r.uploadName||r.name)})),t.data=i):(t.contentType=o.type||"application/octet-stream",t.data=t.blob||o),t.blob=null},_initIframeSettings:function(t){var i=e("<a></a>").prop("href",t.url).prop("host");t.dataType="iframe "+(t.dataType||""),t.formData=this._getFormData(t),t.redirect&&i&&i!==location.host&&t.formData.push({name:t.redirectParamName||"redirect",value:t.redirect})},_initDataSettings:function(e){this._isXHRUpload(e)?(this._chunkedUpload(e,!0)||(e.data||this._initXHRData(e),this._initProgressListener(e)),e.postMessage&&(e.dataType="postmessage "+(e.dataType||""))):this._initIframeSettings(e)},_getParamName:function(t){var i=e(t.fileInput),n=t.paramName;return n?e.isArray(n)||(n=[n]):(n=[],i.each(function(){for(var t=e(this),i=t.prop("name")||"files[]",o=(t.prop("files")||[1]).length;o;)n.push(i),o-=1}),n.length||(n=[i.prop("name")||"files[]"])),n},_initFormSettings:function(t){t.form&&t.form.length||(t.form=e(t.fileInput.prop("form")),t.form.length||(t.form=e(this.options.fileInput.prop("form")))),t.paramName=this._getParamName(t),t.url||(t.url=t.form.prop("action")||location.href),t.type=(t.type||"string"===e.type(t.form.prop("method"))&&t.form.prop("method")||"").toUpperCase(),"POST"!==t.type&&"PUT"!==t.type&&"PATCH"!==t.type&&(t.type="POST"),t.formAcceptCharset||(t.formAcceptCharset=t.form.attr("accept-charset"))},_getAJAXSettings:function(t){var i=e.extend({},this.options,t);return this._initFormSettings(i),this._initDataSettings(i),i},_getDeferredState:function(e){return e.state?e.state():e.isResolved()?"resolved":e.isRejected()?"rejected":"pending"},_enhancePromise:function(e){return e.success=e.done,e.error=e.fail,e.complete=e.always,e},_getXHRPromise:function(t,i,n){var o=e.Deferred(),r=o.promise();return i=i||this.options.context||r,t===!0?o.resolveWith(i,n):t===!1&&o.rejectWith(i,n),r.abort=o.promise,this._enhancePromise(r)},_addConvenienceMethods:function(t,i){var n=this,o=function(t){return e.Deferred().resolveWith(n,t).promise()};i.process=function(t,r){return(t||r)&&(i._processQueue=this._processQueue=(this._processQueue||o([this])).pipe(function(){return i.errorThrown?e.Deferred().rejectWith(n,[i]).promise():o(arguments)}).pipe(t,r)),this._processQueue||o([this])},i.submit=function(){return"pending"!==this.state()&&(i.jqXHR=this.jqXHR=n._trigger("submit",e.Event("submit",{delegatedEvent:t}),this)!==!1&&n._onSend(t,this)),this.jqXHR||n._getXHRPromise()},i.abort=function(){return this.jqXHR?this.jqXHR.abort():(this.errorThrown="abort",n._trigger("fail",null,this),n._getXHRPromise(!1))},i.state=function(){return this.jqXHR?n._getDeferredState(this.jqXHR):this._processQueue?n._getDeferredState(this._processQueue):void 0},i.processing=function(){return!this.jqXHR&&this._processQueue&&"pending"===n._getDeferredState(this._processQueue)},i.progress=function(){return this._progress},i.response=function(){return this._response}},_getUploadedBytes:function(e){var t=e.getResponseHeader("Range"),i=t&&t.split("-"),n=i&&i.length>1&&parseInt(i[1],10);return n&&n+1},_chunkedUpload:function(t,i){t.uploadedBytes=t.uploadedBytes||0;var n,o,r=this,s=t.files[0],a=s.size,l=t.uploadedBytes,u=t.maxChunkSize||a,p=this._blobSlice,d=e.Deferred(),f=d.promise();return this._isXHRUpload(t)&&p&&(l||a>u)&&!t.data?i?!0:l>=a?(s.error=t.i18n("uploadedBytes"),this._getXHRPromise(!1,t.context,[null,"error",s.error])):(o=function(){var i=e.extend({},t),f=i._progress.loaded;i.blob=p.call(s,l,l+u,s.type),i.chunkSize=i.blob.size,i.contentRange="bytes "+l+"-"+(l+i.chunkSize-1)+"/"+a,r._initXHRData(i),r._initProgressListener(i),n=(r._trigger("chunksend",null,i)!==!1&&e.ajax(i)||r._getXHRPromise(!1,i.context)).done(function(n,s,u){l=r._getUploadedBytes(u)||l+i.chunkSize,f+i.chunkSize-i._progress.loaded&&r._onProgress(e.Event("progress",{lengthComputable:!0,loaded:l-i.uploadedBytes,total:l-i.uploadedBytes}),i),t.uploadedBytes=i.uploadedBytes=l,i.result=n,i.textStatus=s,i.jqXHR=u,r._trigger("chunkdone",null,i),r._trigger("chunkalways",null,i),a>l?o():d.resolveWith(i.context,[n,s,u])}).fail(function(e,t,n){i.jqXHR=e,i.textStatus=t,i.errorThrown=n,r._trigger("chunkfail",null,i),r._trigger("chunkalways",null,i),d.rejectWith(i.context,[e,t,n])})},this._enhancePromise(f),f.abort=function(){return n.abort()},o(),f):!1},_beforeSend:function(e,t){0===this._active&&(this._trigger("start"),this._bitrateTimer=new this._BitrateTimer,this._progress.loaded=this._progress.total=0,this._progress.bitrate=0),this._initResponseObject(t),this._initProgressObject(t),t._progress.loaded=t.loaded=t.uploadedBytes||0,t._progress.total=t.total=this._getTotal(t.files)||1,t._progress.bitrate=t.bitrate=0,this._active+=1,this._progress.loaded+=t.loaded,this._progress.total+=t.total},_onDone:function(t,i,n,o){var r=o._progress.total,s=o._response;o._progress.loaded<r&&this._onProgress(e.Event("progress",{lengthComputable:!0,loaded:r,total:r}),o),s.result=o.result=t,s.textStatus=o.textStatus=i,s.jqXHR=o.jqXHR=n,this._trigger("done",null,o)},_onFail:function(e,t,i,n){var o=n._response;n.recalculateProgress&&(this._progress.loaded-=n._progress.loaded,this._progress.total-=n._progress.total),o.jqXHR=n.jqXHR=e,o.textStatus=n.textStatus=t,o.errorThrown=n.errorThrown=i,this._trigger("fail",null,n)},_onAlways:function(e,t,i,n){this._trigger("always",null,n)},_onSend:function(t,i){i.submit||this._addConvenienceMethods(t,i);var n,o,r,s,a=this,l=a._getAJAXSettings(i),u=function(){return a._sending+=1,l._bitrateTimer=new a._BitrateTimer,n=n||((o||a._trigger("send",e.Event("send",{delegatedEvent:t}),l)===!1)&&a._getXHRPromise(!1,l.context,o)||a._chunkedUpload(l)||e.ajax(l)).done(function(e,t,i){a._onDone(e,t,i,l)}).fail(function(e,t,i){a._onFail(e,t,i,l)}).always(function(e,t,i){if(a._onAlways(e,t,i,l),a._sending-=1,a._active-=1,l.limitConcurrentUploads&&l.limitConcurrentUploads>a._sending)for(var n=a._slots.shift();n;){if("pending"===a._getDeferredState(n)){n.resolve();break}n=a._slots.shift()}0===a._active&&a._trigger("stop")})};return this._beforeSend(t,l),this.options.sequentialUploads||this.options.limitConcurrentUploads&&this.options.limitConcurrentUploads<=this._sending?(this.options.limitConcurrentUploads>1?(r=e.Deferred(),this._slots.push(r),s=r.pipe(u)):(this._sequence=this._sequence.pipe(u,u),s=this._sequence),s.abort=function(){return o=[void 0,"abort","abort"],n?n.abort():(r&&r.rejectWith(l.context,o),u())},this._enhancePromise(s)):u()},_onAdd:function(t,i){var n,o,r,s,a=this,l=!0,u=e.extend({},this.options,i),p=i.files,d=p.length,f=u.limitMultiFileUploads,c=u.limitMultiFileUploadSize,h=u.limitMultiFileUploadSizeOverhead,g=0,m=this._getParamName(u),_=0;if(!d)return!1;if(c&&void 0===p[0].size&&(c=void 0),(u.singleFileUploads||f||c)&&this._isXHRUpload(u))if(u.singleFileUploads||c||!f)if(!u.singleFileUploads&&c)for(r=[],n=[],s=0;d>s;s+=1)g+=p[s].size+h,(s+1===d||g+p[s+1].size+h>c||f&&s+1-_>=f)&&(r.push(p.slice(_,s+1)),o=m.slice(_,s+1),o.length||(o=m),n.push(o),_=s+1,g=0);else n=m;else for(r=[],n=[],s=0;d>s;s+=f)r.push(p.slice(s,s+f)),o=m.slice(s,s+f),o.length||(o=m),n.push(o);else r=[p],n=[m];return i.originalFiles=p,e.each(r||p,function(o,s){var u=e.extend({},i);return u.files=r?s:[s],u.paramName=n[o],a._initResponseObject(u),a._initProgressObject(u),a._addConvenienceMethods(t,u),l=a._trigger("add",e.Event("add",{delegatedEvent:t}),u)}),l},_replaceFileInput:function(t){var i=t.fileInput,n=i.clone(!0),o=i.is(document.activeElement);t.fileInputClone=n,e("<form></form>").append(n)[0].reset(),i.after(n).detach(),o&&n.focus(),e.cleanData(i.unbind("remove")),this.options.fileInput=this.options.fileInput.map(function(e,t){return t===i[0]?n[0]:t}),i[0]===this.element[0]&&(this.element=n)},_handleFileTreeEntry:function(t,i){var n,o=this,r=e.Deferred(),s=function(e){e&&!e.entry&&(e.entry=t),r.resolve([e])},a=function(e){o._handleFileTreeEntries(e,i+t.name+"/").done(function(e){r.resolve(e)}).fail(s)},l=function p(){n.readEntries(function(e){e.length?(u=u.concat(e),p()):a(u)},s)},u=[];return i=i||"",t.isFile?t._file?(t._file.relativePath=i,r.resolve(t._file)):t.file(function(e){e.relativePath=i,r.resolve(e)},s):t.isDirectory?(n=t.createReader(),l()):r.resolve([]),r.promise()},_handleFileTreeEntries:function(t,i){var n=this;return e.when.apply(e,e.map(t,function(e){return n._handleFileTreeEntry(e,i)})).pipe(function(){return Array.prototype.concat.apply([],arguments)})},_getDroppedFiles:function(t){t=t||{};var i=t.items;return i&&i.length&&(i[0].webkitGetAsEntry||i[0].getAsEntry)?this._handleFileTreeEntries(e.map(i,function(e){var t;return e.webkitGetAsEntry?(t=e.webkitGetAsEntry(),t&&(t._file=e.getAsFile()),t):e.getAsEntry()})):e.Deferred().resolve(e.makeArray(t.files)).promise()},_getSingleFileInputFiles:function(t){t=e(t);var i,n,o=t.prop("webkitEntries")||t.prop("entries");if(o&&o.length)return this._handleFileTreeEntries(o);if(i=e.makeArray(t.prop("files")),i.length)void 0===i[0].name&&i[0].fileName&&e.each(i,function(e,t){t.name=t.fileName,t.size=t.fileSize});else{if(n=t.prop("value"),!n)return e.Deferred().resolve([]).promise();i=[{name:n.replace(/^.*\\/,"")}]}return e.Deferred().resolve(i).promise()},_getFileInputFiles:function(t){return t instanceof e&&1!==t.length?e.when.apply(e,e.map(t,this._getSingleFileInputFiles)).pipe(function(){return Array.prototype.concat.apply([],arguments)}):this._getSingleFileInputFiles(t)},_onChange:function(t){var i=this,n={fileInput:e(t.target),form:e(t.target.form)};this._getFileInputFiles(n.fileInput).always(function(o){n.files=o,i.options.replaceFileInput&&i._replaceFileInput(n),i._trigger("change",e.Event("change",{delegatedEvent:t}),n)!==!1&&i._onAdd(t,n)})},_onPaste:function(t){var i=t.originalEvent&&t.originalEvent.clipboardData&&t.originalEvent.clipboardData.items,n={files:[]};i&&i.length&&(e.each(i,function(e,t){var i=t.getAsFile&&t.getAsFile();i&&n.files.push(i)}),this._trigger("paste",e.Event("paste",{delegatedEvent:t}),n)!==!1&&this._onAdd(t,n))},_onDrop:function(t){t.dataTransfer=t.originalEvent&&t.originalEvent.dataTransfer;var i=this,n=t.dataTransfer,o={};n&&n.files&&n.files.length&&(t.preventDefault(),this._getDroppedFiles(n).always(function(n){o.files=n,i._trigger("drop",e.Event("drop",{delegatedEvent:t}),o)!==!1&&i._onAdd(t,o)}))},_onDragOver:t("dragover"),_onDragEnter:t("dragenter"),_onDragLeave:t("dragleave"),_initEventHandlers:function(){this._isXHRUpload(this.options)&&(this._on(this.options.dropZone,{dragover:this._onDragOver,drop:this._onDrop,dragenter:this._onDragEnter,dragleave:this._onDragLeave}),this._on(this.options.pasteZone,{paste:this._onPaste})),e.support.fileInput&&this._on(this.options.fileInput,{change:this._onChange})},_destroyEventHandlers:function(){this._off(this.options.dropZone,"dragenter dragleave dragover drop"),this._off(this.options.pasteZone,"paste"),this._off(this.options.fileInput,"change")},_setOption:function(t,i){var n=-1!==e.inArray(t,this._specialOptions);n&&this._destroyEventHandlers(),this._super(t,i),n&&(this._initSpecialOptions(),this._initEventHandlers())},_initSpecialOptions:function(){var t=this.options;void 0===t.fileInput?t.fileInput=this.element.is('input[type="file"]')?this.element:this.element.find('input[type="file"]'):t.fileInput instanceof e||(t.fileInput=e(t.fileInput)),t.dropZone instanceof e||(t.dropZone=e(t.dropZone)),t.pasteZone instanceof e||(t.pasteZone=e(t.pasteZone))},_getRegExp:function(e){var t=e.split("/"),i=t.pop();return t.shift(),new RegExp(t.join("/"),i)},_isRegExpOption:function(t,i){return"url"!==t&&"string"===e.type(i)&&/^\/.*\/[igm]{0,3}$/.test(i)},_initDataAttributes:function(){var t=this,i=this.options,n=this.element.data();e.each(this.element[0].attributes,function(e,o){var r,s=o.name.toLowerCase();/^data-/.test(s)&&(s=s.slice(5).replace(/-[a-z]/g,function(e){return e.charAt(1).toUpperCase()}),r=n[s],t._isRegExpOption(s,r)&&(r=t._getRegExp(r)),i[s]=r)})},_create:function(){this._initDataAttributes(),this._initSpecialOptions(),this._slots=[],this._sequence=this._getXHRPromise(!0),this._sending=this._active=0,this._initProgressObject(this),this._initEventHandlers()},active:function(){return this._active},progress:function(){return this._progress},add:function(t){var i=this;t&&!this.options.disabled&&(t.fileInput&&!t.files?this._getFileInputFiles(t.fileInput).always(function(e){t.files=e,i._onAdd(null,t)}):(t.files=e.makeArray(t.files),this._onAdd(null,t)))},send:function(t){if(t&&!this.options.disabled){if(t.fileInput&&!t.files){var i,n,o=this,r=e.Deferred(),s=r.promise();return s.abort=function(){return n=!0,i?i.abort():(r.reject(null,"abort","abort"),s)},this._getFileInputFiles(t.fileInput).always(function(e){if(!n){if(!e.length)return void r.reject();t.files=e,i=o._onSend(null,t),i.then(function(e,t,i){r.resolve(e,t,i)},function(e,t,i){r.reject(e,t,i)})}}),this._enhancePromise(s)}if(t.files=e.makeArray(t.files),t.files.length)return this._onSend(null,t)}return this._getXHRPromise(!1,t&&t.context)}})});var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e};+function(e){function t(i){this.options=e.extend({},t.DEFAULTS,i),this.$element=e('            <div class="modal upload fade" tabindex="-1" role="dialog">                 <div class="modal-dialog" role="document">                     <div class="modal-content">                         <div class="modal-header">                             <div class="pull-left">                                 <h4 class="modal-title" id="title">Upload</h4>                             </div>                             <div class="pull-right">                                 <i class="fa fa-cloud-upload" submit></i>                                 <i class="fa fa-search" openfile></i>                             </div>                         </div>                         <div class="modal-body">                             <div id="drogbox" class="dragbox">                                 <input type="file" name="" multiple />                                 <div class="content">                                     <i class="fa fa-cloud-upload"></i>                                     <h1>拖动上传</h1>                                     <p class="tips">支持上传的文件格式png | jpg | jpeg</p>                                 </div>                             </div>                             <div id="queue" class="upload-queue">                                 <div class="seperator"></div>                             </div>                         </div>                     </div>                 </div>             </div>         '),this.$element.find(".tips").text(this.options.tips),this.$element.find("#title").text(this.options.title),this.$element.find('input[type="file"]').attr("name",this.options.name),this.$queue=this.$element.find("#queue"),this.upload_queue=[],this.queue_template=this.options.queue_template,this.$dragbox=this.$element.find("#drogbox")}function i(i){return this.each(function(){var n=e(this),o=n.data("aurora.upload"),r=e.extend({},t.DEFAULTS,n.data(),"object"==("undefined"==typeof i?"undefined":_typeof(i))&&i);o||n.data("aurora.upload",o=new t(r)),"string"==typeof i&&o[i]()})}t.VERSION="0.1.0",t.DEFAULTS={queue_template:'                     <div class="col-xs-12 item fadeInUp">                         <div class="col-xs-2"><i target="file-icon" class="fa"></i></div>                         <div class="col-xs-10">                             <div class="row">                                 <div class="pull-left">                                     <label target="name"></label>                                 </div>                                 <div class="pull-right">                                     <span target="filesize"></span>                                 </div>                             </div>                             <div class="row status">                                 <span target="status">等待上传</span>                                 <div class="pull-right">                                     <i class="fa fa-check"></i>                                     <i class="fa fa-times" target="delete"></i>                                 </div>                             </div>                             <div class="row">                                 <div class="process-bar">                                     <div target="process"></div>                                 </div>                             </div>                         </div>                     </div>',title:"上传",success_tips:"已上传",fail_tips:"上传失败，请重试",tips:"支持上传的文件格式png | jpg | jpeg | gif",filter:"(.|/)(gif|jpe?g|png)$",maxsize:999e3,minsize:0,name:"upload",done:function(e,t){console.log(t.result)},fail:function(e,t){console.log("fail")}},t.prototype.show=function(){var t=this;e("body").append(this.$element),this.$element.modal("show"),this.listen(),this.$element.on("hidden.bs.modal",function(){t.hide()})},t.prototype.hide=function(){this.$element.remove();for(var e=this.upload_queue.length-1;e>=0;e--)this.upload_queue[e].context.remove(),this.upload_queue.splice(e,1),this.$dragbox.removeClass("fadeOut"),this.$queue.removeClass("fadeIn")},t.prototype.listen=function(){var t=this;t.$dragbox.on("added.aurora.upload",function(){
t.$dragbox.addClass("fadeOut"),t.$queue.addClass("fadeIn")}),t.$element.find("[submit]").on("click",function(){t.upload()});var i={url:t.options.url,maxFileSize:t.options.maxsize,minFileSize:t.options.minsize,dropZone:t.$dragbox,add:function(i,n){function o(e){return"number"!=typeof e?"":e>=1e9?(e/1e9).toFixed(2)+" GB":e>=1e6?(e/1e6).toFixed(2)+" MB":(e/1e3).toFixed(2)+" KB"}var r,s=function(){var e=n.files[0].name.lastIndexOf("."),t=n.files[0].name.length;return n.files[0].name.substring(e,t)}(),a=n.files[0],l=a.lastModified+a.name+a.size;if(new RegExp(t.options.filter,"i").test(s)){for(var u=t.upload_queue.length-1;u>=0;u--)if(t.upload_queue[u].hash==l)return;var i=e.Event("added.aurora.upload");t.$dragbox.trigger(i),r=/doc|docx|pages/.test(s)?"fa-file-word-o":/xls|xlsx|numbers/.test(s)?"fa-file-excel-o":/ppt|pptx|key/.test(s)?"fa-file-powerpoint-o":/pdf/.test(s)?"fa-file-pdf-o":/jpg|png|gif|jpeg/.test(s)?"fa-file-image-o":/zip|tar|rar|7zip/.test(s)?"fa-file-zip-o":"fa-file-o";var p=e(t.queue_template);p.find('[target="name"]').text(n.files[0].name),p.find('[target="filesize"]').text(o(n.files[0].size)),p.find('[target="file-icon"]').addClass(r),p.find('[target="delete"]').on("click",function(){t["delete"](n)}),p.data("upload.data",n),n.context=p.appendTo(t.$queue),n.hash=l,t.upload_queue.push(n)}},progress:function n(e,t){var n=parseInt(t.loaded/t.total*100,10);t.context.find('[target="process"]').css("width",n+"%")},fail:function(e,i){i.context.find('[target="status"]').addClass("animated fadeInUp").text(t.options.fail_tips),t.options.fail(e,i)},done:function(e,i){i.result.success?(i.context.find('[target="status"]').addClass("animated fadeInUp").text(t.options.success_tips),i.context.find(".status").addClass("checked"),setTimeout(function(){i.context.find(".status .fa-check").css({display:"block"}),i.context.find(".status .fa-times").css({display:"none"})},800)):(i.context.find('[target="status"]').addClass("animated fadeInUp").text(t.options.fail_tips),i.context.find(".status").addClass("checked"),setTimeout(function(){i.context.find(".status .fa-check").css({display:"none"}),i.context.find(".status .fa-times").css({display:"block"})},800)),t.options.done(e,i)}};t.options.formData&&(i.formData=t.options.formData),t.options.beforeSend&&(i.beforeSend=t.options.beforeSend),this.$element.fileupload(i),e(document).on("drop dragover",function(e){e.preventDefault()}),this.$element.find("[openfile]").on("click",function(){t.$element.find('input[type="file"]').click()})},t.prototype.upload=function(){for(var e=this,t=e.upload_queue.length-1;t>=0;t--)e.upload_queue[t].uploaded||e.upload_queue[t].submit(),e.upload_queue[t].uploaded=!0},t.prototype["delete"]=function(e){var t=this;e.context.addClass("fadeOutUp"),setTimeout(function(){e.context.remove();var i=t.upload_queue.indexOf(e);t.upload_queue.splice(i,1),0==t.upload_queue.length&&(t.$dragbox.removeClass("fadeOut"),t.$queue.removeClass("fadeIn"))},500)};var n=e.fn.upload;e.fn.upload=i,e.fn.upload.Constructor=t,e.fn.upload.noConflict=function(){return e.fn.upload=n,this},e(document).on("click.aurora.upload.data-api",'[data-toggle="upload"]',function(t){i.call(e(this),"show")})}(jQuery);